<div style="text-align:right"><a href="http://www.jpgarcia.com.ar/index.php/2007/10/17/como-obtener-el-testid-generado-por-visual-studio-en-un-archivo-loadtest/">Spanish Version</a></div>
<p>During these days I have been working on a tool that automates the execution of a load test.</p>  <p>Our objective was to parse a .loadtest template file, based on a template, which has been configured for a specific scenario with a set of counters. Once we have parsed the template we are ready to add the TestMix node and a TestProfile node for each test that we want to execute from those defined on test assembly.</p>  <h3>The Obstacle</h3>  <p>When I was creating the TestProfile node, I realized that each unit test has an specific Id (represented by a unique identifier a.k.a Guid). What I didn't noticed until we've run the load test is that this identifier was generated dynamically by Visual Studio.</p>  <p>We tried going under the hood , unluckily, using reflector to analyze some of Visual Studio assemblies in order to find how these identifiers were generated.</p>  <h3>The suggested workaround</h3>  <p>Searching on the web I found a <a href="http://www.breaman.net/blog/default,month,2006-10.aspx" target="_blank">post</a> with a method which generates the Guid we’re looking for:</p>  <div style="padding-right: 4px;padding-left: 4px;font-size: 8pt;padding-bottom: 4px;margin: 20px 0px 10px;width: 97.5%;padding-top: 4px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">   <div style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">     <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace"><span style="color: #0000ff">private</span> <span style="color: #0000ff">static</span> Guid GetGuidFromString(<span style="color: #0000ff">string</span> <span style="color: #0000ff">value</span>)</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">{</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    SHA1CryptoServiceProvider provider = <span style="color: #0000ff">new</span> SHA1CryptoServiceProvider();</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    <span style="color: #0000ff">byte</span>[] buffer1 = provider.ComputeHash(Encoding.Unicode.GetBytes(<span style="color: #0000ff">value</span>));</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    <span style="color: #0000ff">byte</span>[] buffer2 = <span style="color: #0000ff">new</span> <span style="color: #0000ff">byte</span>[0x10];</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    Array.Copy(buffer1, buffer2, 0×10);</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    <span style="color: #0000ff">return</span> <span style="color: #0000ff">new</span> Guid(buffer2);</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">}</pre>
  </div>
</div>

<p>Using the recently created function we’re able to retrieve the Guid for a given assembly as I’m showing below</p>

<div style="padding-right: 4px;padding-left: 4px;font-size: 8pt;padding-bottom: 4px;margin: 20px 0px 10px;width: 97.5%;padding-top: 4px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">
  <div style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">
    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace"><span style="color: #0000ff">private</span> <span style="color: #0000ff">static</span> IList&lt;TestEntry&gt; GetUnitTests()</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">{</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    IList&lt;TestEntry&gt; unitTests = <span style="color: #0000ff">new</span> List&lt;TestEntry&gt;();</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    Assembly assembly = Assembly.LoadFrom(“Tests\\PerformanceTests.dll“);</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    Type[] assemblyTypes = assembly.GetTypes(); </pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">&#160;</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    <span style="color: #0000ff">foreach</span> (Type type <span style="color: #0000ff">in</span> assemblyTypes)</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    {</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">        <span style="color: #0000ff">if</span> (type.IsClass &amp;&amp; </pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">            type.GetCustomAttributes(<span style="color: #0000ff">typeof</span>(TestClassAttribute), <span style="color: #0000ff">false</span>).Length &gt; 0)</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">        {</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">            MethodInfo[] info = type.GetMethods(); </pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">&#160;</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">            <span style="color: #0000ff">foreach</span> (MethodInfo m <span style="color: #0000ff">in</span> info)</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">            {</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">                <span style="color: #0000ff">if</span> (m.GetCustomAttributes(<span style="color: #0000ff">typeof</span>(TestMethodAttribute), <span style="color: #0000ff">false</span>).Length &gt; 0)</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">                {</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">                    Guid testGuid = GetGUIDFromString(type.FullName + “.“ + m.Name);</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">                    unitTests.Add(<span style="color: #0000ff">new</span> TestEntry(testGuid, m.Name));</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">                }</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">            }</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">        }</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    } </pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">&#160;</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">    <span style="color: #0000ff">return</span> unitTests;</pre>

    <pre style="padding-right: 0px;padding-left: 0px;font-size: 8pt;padding-bottom: 0px;margin: 0em;width: 100%;color: black;padding-top: 0px;font-family: consolas, &#39;Courier New&#39;, courier, monospace">}</pre>
  </div>
</div>

<p>Hope you find it useful!</p>
